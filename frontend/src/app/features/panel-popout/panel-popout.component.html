<div class="popout-container">
  <div class="popout-header">
    <div class="header-left">
      <h2>{{ panelTitle }}</h2>
      <span class="panel-id">{{ panelId }}</span>
    </div>
    <div class="header-actions">
      <div class="filters-summary" *ngIf="hasActiveFilters && panelType === 'picker'">
        <span class="summary-label">Selected:</span>
        <span class="summary-count">{{ selectionCount }} model(s)</span>
        <button nz-button nzType="primary" nzDanger nzSize="small" (click)="onClearAll()">
          Clear All
        </button>
      </div>
      <button nz-button nzType="default" (click)="closeWindow()">
        <i nz-icon nzType="close"></i>
        Close
      </button>
    </div>
  </div>

  <div class="popout-content">
    <!-- Model Picker Panel -->
    <div *ngIf="panelType === 'picker'" class="panel-wrapper">
      <app-table-picker
        [initialSelections]="pickerInitialSelections"
        [clearTrigger]="pickerClearTrigger"
        (selectionChange)="onPickerSelectionChange($event)"
      >
      </app-table-picker>
    </div>

    <!-- Vehicle Results Panel -->
    <div *ngIf="panelType === 'results'" class="panel-wrapper">
      <div *ngIf="hasActiveFilters; else noFilters">
        <app-results-table></app-results-table>
      </div>
      <ng-template #noFilters>
        <nz-empty
          nzNotFoundContent="Select models from the picker to see results"
          [nzNotFoundImage]="'simple'"
        ></nz-empty>
      </ng-template>
    </div>

    <!-- PlotlyJS Chart Panel (placeholder) -->
    <div *ngIf="panelType === 'plotly' || panelType === 'chart'" class="panel-wrapper">
      <div class="placeholder-chart">
        <i nz-icon nzType="line-chart" style="font-size: 64px; color: #1890ff;"></i>
        <h3>PlotlyJS Chart</h3>
        <p>Chart component would render here</p>
        <p class="meta">Panel ID: {{ panelId }}</p>
      </div>
    </div>

    <!-- Unknown panel type -->
    <div *ngIf="panelType !== 'picker' && panelType !== 'results' && panelType !== 'plotly' && panelType !== 'chart'" class="panel-wrapper">
      <nz-empty
        [nzNotFoundContent]="'Unknown panel type: ' + panelType"
        [nzNotFoundImage]="'simple'"
      ></nz-empty>
    </div>
  </div>
</div>
