<div class="workspace-container">
  <!-- Header -->
  <div class="workspace-header">
    <div>
      <h2>Vehicle Discovery</h2>
      <p class="subtitle">
        Select manufacturers and models to explore the catalog
      </p>
    </div>
    <div class="actions">
      <div *ngIf="hasActiveFilters" class="filters-summary">
        <span class="summary-label">Active Filters:</span>
        <span class="summary-count"
          >{{ selectionCount }} model(s) selected</span
        >
      </div>
      <button
        nz-button
        nzType="default"
        nzSize="small"
        (click)="expandAllGrids()"
        nz-tooltip="Expand all sections"
      >
        <i nz-icon nzType="down"></i>
        Expand All
      </button>
      <button
        nz-button
        nzType="default"
        nzSize="small"
        (click)="collapseAllGrids()"
        nz-tooltip="Collapse all sections"
      >
        <i nz-icon nzType="up"></i>
        Collapse All
      </button>
      <button nz-button nzType="default" (click)="onClearAll()">
        Clear All
      </button>
    </div>
  </div>

  <!-- Grid 1: Query Control -->
  <div *ngIf="grids[0]" class="grid-section">
    <div class="grid-section-header" (click)="toggleGridCollapse(grids[0].id)">
      <h3 class="grid-section-title">{{ getGridHeaderLabel(grids[0].id) }}</h3>
      <button
        type="button"
        class="grid-toggle-btn"
        [attr.aria-label]="isGridCollapsed(grids[0].id) ? 'Expand' : 'Collapse'"
      >
        <i
          nz-icon
          [nzType]="isGridCollapsed(grids[0].id) ? 'down' : 'up'"
          nzTheme="outline"
        ></i>
      </button>
    </div>
    <div
      class="grid-section-content"
      [class.collapsed]="isGridCollapsed(grids[0].id)"
    >
      <div class="grid-container-200" [attr.data-grid-id]="grids[0].id">
        <gridster [options]="grids[0].options">
          <gridster-item *ngFor="let item of grids[0]?.items" [item]="item">
            <div class="panel-container">
              <div class="panel-header drag-handle">
                <span class="panel-title">
                  <i nz-icon nzType="drag" nzTheme="outline"></i>
                  <ng-container [ngSwitch]="item.panelType">
                    <ng-container *ngSwitchCase="'picker'"
                      >Model Picker</ng-container
                    >
                    <ng-container *ngSwitchCase="'results'"
                      >Vehicle Results</ng-container
                    >
                    <ng-container *ngSwitchCase="'query-control'"
                      >Query Control</ng-container
                    >
                    <ng-container *ngSwitchCase="'plotly-charts'"
                      >Interactive Charts (Plotly)</ng-container
                    >
                    <ng-container *ngSwitchCase="'static-parabola'"
                      >Static Parabola Chart</ng-container
                    >
                    <ng-container *ngSwitchDefault>Panel</ng-container>
                  </ng-container>
                </span>
                <div class="panel-actions">
                  <i
                    nz-icon
                    nzType="export"
                    nzTheme="outline"
                    nz-tooltip="Pop out to new window"
                    (click)="
                      popOutPanel(grids[0].id, item); $event.stopPropagation()
                    "
                    class="action-icon popout-icon"
                  ></i>
                  <i
                    nz-icon
                    [nzType]="
                      item.panelType === 'picker'
                        ? getPanelCollapseState(grids[0].id)
                          ? 'down'
                          : 'up'
                        : 'close'
                    "
                    nzTheme="outline"
                    (click)="
                      item.panelType === 'picker'
                        ? togglePanelCollapse(grids[0].id)
                        : removePanel(item, grids[0].id)
                    "
                    class="action-icon"
                  ></i>
                </div>
              </div>
              <div
                class="panel-content no-drag"
                [hidden]="
                  item.panelType === 'picker' &&
                  getPanelCollapseState(grids[0].id)
                "
              >
                <!-- Dynamic panel content based on panelType -->
                <div *ngIf="item.panelType === 'query-control'">
                  <app-query-control
                    (filterAdd)="onFilterAdd($event)"
                    (filterRemove)="onFilterRemove($event)"
                  >
                  </app-query-control>
                </div>
                <div *ngIf="item.panelType === 'picker'">
                  <!-- NEW: BasePickerComponent (Configuration-Driven) -->
                  <div
                    style="
                      margin-bottom: 8px;
                      padding: 8px;
                      background: #e6f7ff;
                      border: 1px solid #91d5ff;
                      border-radius: 4px;
                    "
                  >
                    <strong style="color: #1890ff"
                      >âœ¨ NEW: BasePickerComponent</strong
                    >
                    <span style="margin-left: 8px; font-size: 12px; color: #666"
                      >(Configuration-driven)</span
                    >
                  </div>
                  <app-base-picker
                    [configId]="'manufacturer-model'"
                  ></app-base-picker>

                  <!-- ORIGINAL: TablePickerComponent (For comparison) -->
                  <div
                    style="
                      margin: 24px 0 8px 0;
                      padding: 8px;
                      background: #f0f0f0;
                      border: 1px solid #d9d9d9;
                      border-radius: 4px;
                    "
                  >
                    <strong style="color: #666"
                      >ðŸ”¹ ORIGINAL: TablePickerComponent</strong
                    >
                    <span style="margin-left: 8px; font-size: 12px; color: #999"
                      >(Legacy, for comparison)</span
                    >
                  </div>
                  <app-table-picker></app-table-picker>
                </div>
                <div *ngIf="item.panelType === 'results'">
                  <app-results-table></app-results-table>
                </div>
                <div *ngIf="item.panelType === 'plotly-charts'">
                  <app-plotly-histogram></app-plotly-histogram>
                </div>
                <div *ngIf="item.panelType === 'static-parabola'">
                  <app-static-parabola-chart></app-static-parabola-chart>
                </div>
              </div>
            </div>
          </gridster-item>
        </gridster>
      </div>
    </div>
  </div>

  <!-- Grid 2: Model Picker -->
  <div *ngIf="grids[1]" class="grid-section">
    <div class="grid-section-header" (click)="toggleGridCollapse(grids[1].id)">
      <h3 class="grid-section-title">{{ getGridHeaderLabel(grids[1].id) }}</h3>
      <button
        type="button"
        class="grid-toggle-btn"
        [attr.aria-label]="isGridCollapsed(grids[1].id) ? 'Expand' : 'Collapse'"
      >
        <i
          nz-icon
          [nzType]="isGridCollapsed(grids[1].id) ? 'down' : 'up'"
          nzTheme="outline"
        ></i>
      </button>
    </div>
    <div
      class="grid-section-content"
      [class.collapsed]="isGridCollapsed(grids[1].id)"
    >
      <div class="grid-container-8" [attr.data-grid-id]="grids[1].id">
        <gridster [options]="grids[1].options">
          <gridster-item *ngFor="let item of grids[1]?.items" [item]="item">
            <div class="panel-container">
              <div class="panel-header drag-handle">
                <span class="panel-title">
                  <i nz-icon nzType="drag" nzTheme="outline"></i>
                  <ng-container [ngSwitch]="item.panelType">
                    <ng-container *ngSwitchCase="'picker'"
                      >Model Picker</ng-container
                    >
                    <ng-container *ngSwitchCase="'results'"
                      >Vehicle Results</ng-container
                    >
                    <ng-container *ngSwitchCase="'query-control'"
                      >Query Control</ng-container
                    >
                    <ng-container *ngSwitchCase="'plotly-charts'"
                      >Interactive Charts (Plotly)</ng-container
                    >
                    <ng-container *ngSwitchCase="'static-parabola'"
                      >Static Parabola Chart</ng-container
                    >
                    <ng-container *ngSwitchDefault>Panel</ng-container>
                  </ng-container>
                </span>
                <div class="panel-actions">
                  <i
                    nz-icon
                    nzType="export"
                    nzTheme="outline"
                    nz-tooltip="Pop out to new window"
                    (click)="
                      popOutPanel(grids[1].id, item); $event.stopPropagation()
                    "
                    class="action-icon popout-icon"
                  ></i>
                  <i
                    nz-icon
                    [nzType]="
                      item.panelType === 'picker'
                        ? getPanelCollapseState(grids[1].id)
                          ? 'down'
                          : 'up'
                        : 'close'
                    "
                    nzTheme="outline"
                    (click)="
                      item.panelType === 'picker'
                        ? togglePanelCollapse(grids[1].id)
                        : removePanel(item, grids[1].id)
                    "
                    class="action-icon"
                  ></i>
                </div>
              </div>
              <div
                class="panel-content no-drag"
                [hidden]="
                  item.panelType === 'picker' &&
                  getPanelCollapseState(grids[1].id)
                "
              >
                <!-- Dynamic panel content based on panelType -->
                <div *ngIf="item.panelType === 'query-control'">
                  <app-query-control
                    (filterAdd)="onFilterAdd($event)"
                    (filterRemove)="onFilterRemove($event)"
                  >
                  </app-query-control>
                </div>
                <div *ngIf="item.panelType === 'picker'">
                  <!-- NEW: BasePickerComponent (Configuration-Driven) -->
                  <div
                    style="
                      margin-bottom: 8px;
                      padding: 8px;
                      background: #e6f7ff;
                      border: 1px solid #91d5ff;
                      border-radius: 4px;
                    "
                  >
                    <strong style="color: #1890ff"
                      >âœ¨ NEW: BasePickerComponent</strong
                    >
                    <span style="margin-left: 8px; font-size: 12px; color: #666"
                      >(Configuration-driven)</span
                    >
                  </div>
                  <app-base-picker
                    [configId]="'manufacturer-model'"
                  ></app-base-picker>

                  <!-- ORIGINAL: TablePickerComponent (For comparison) -->
                  <div
                    style="
                      margin: 24px 0 8px 0;
                      padding: 8px;
                      background: #f0f0f0;
                      border: 1px solid #d9d9d9;
                      border-radius: 4px;
                    "
                  >
                    <strong style="color: #666"
                      >ðŸ”¹ ORIGINAL: TablePickerComponent</strong
                    >
                    <span style="margin-left: 8px; font-size: 12px; color: #999"
                      >(Legacy, for comparison)</span
                    >
                  </div>
                  <app-table-picker></app-table-picker>
                </div>
                <div *ngIf="item.panelType === 'results'">
                  <app-results-table></app-results-table>
                </div>
                <div *ngIf="item.panelType === 'plotly-charts'">
                  <app-plotly-histogram></app-plotly-histogram>
                </div>
                <div *ngIf="item.panelType === 'static-parabola'">
                  <app-static-parabola-chart></app-static-parabola-chart>
                </div>
              </div>
            </div>
          </gridster-item>
        </gridster>
      </div>
    </div>
  </div>

  <!-- Grid 3: Vehicle Results -->
  <div *ngIf="grids[2]" class="grid-section">
    <div class="grid-section-header" (click)="toggleGridCollapse(grids[2].id)">
      <h3 class="grid-section-title">{{ getGridHeaderLabel(grids[2].id) }}</h3>
      <button
        type="button"
        class="grid-toggle-btn"
        [attr.aria-label]="isGridCollapsed(grids[2].id) ? 'Expand' : 'Collapse'"
      >
        <i
          nz-icon
          [nzType]="isGridCollapsed(grids[2].id) ? 'down' : 'up'"
          nzTheme="outline"
        ></i>
      </button>
    </div>
    <div
      class="grid-section-content"
      [class.collapsed]="isGridCollapsed(grids[2].id)"
    >
      <div class="grid-container-9" [attr.data-grid-id]="grids[2].id">
        <gridster [options]="grids[2].options">
          <gridster-item *ngFor="let item of grids[2]?.items" [item]="item">
            <div class="panel-container">
              <div class="panel-header drag-handle">
                <span class="panel-title">
                  <i nz-icon nzType="drag" nzTheme="outline"></i>
                  <ng-container [ngSwitch]="item.panelType">
                    <ng-container *ngSwitchCase="'picker'"
                      >Model Picker</ng-container
                    >
                    <ng-container *ngSwitchCase="'results'"
                      >Vehicle Results</ng-container
                    >
                    <ng-container *ngSwitchCase="'query-control'"
                      >Query Control</ng-container
                    >
                    <ng-container *ngSwitchCase="'plotly-charts'"
                      >Interactive Charts (Plotly)</ng-container
                    >
                    <ng-container *ngSwitchCase="'static-parabola'"
                      >Static Parabola Chart</ng-container
                    >
                    <ng-container *ngSwitchDefault>Panel</ng-container>
                  </ng-container>
                </span>
                <div class="panel-actions">
                  <i
                    nz-icon
                    nzType="export"
                    nzTheme="outline"
                    nz-tooltip="Pop out to new window"
                    (click)="
                      popOutPanel(grids[2].id, item); $event.stopPropagation()
                    "
                    class="action-icon popout-icon"
                  ></i>
                  <i
                    nz-icon
                    [nzType]="
                      item.panelType === 'picker'
                        ? getPanelCollapseState(grids[2].id)
                          ? 'down'
                          : 'up'
                        : 'close'
                    "
                    nzTheme="outline"
                    (click)="
                      item.panelType === 'picker'
                        ? togglePanelCollapse(grids[2].id)
                        : removePanel(item, grids[2].id)
                    "
                    class="action-icon"
                  ></i>
                </div>
              </div>
              <div
                class="panel-content no-drag"
                [hidden]="
                  item.panelType === 'picker' &&
                  getPanelCollapseState(grids[2].id)
                "
              >
                <!-- Dynamic panel content based on panelType -->
                <div *ngIf="item.panelType === 'query-control'">
                  <app-query-control
                    (filterAdd)="onFilterAdd($event)"
                    (filterRemove)="onFilterRemove($event)"
                  >
                  </app-query-control>
                </div>
                <div *ngIf="item.panelType === 'picker'">
                  <!-- NEW: BasePickerComponent (Configuration-Driven) -->
                  <div
                    style="
                      margin-bottom: 8px;
                      padding: 8px;
                      background: #e6f7ff;
                      border: 1px solid #91d5ff;
                      border-radius: 4px;
                    "
                  >
                    <strong style="color: #1890ff"
                      >âœ¨ NEW: BasePickerComponent</strong
                    >
                    <span style="margin-left: 8px; font-size: 12px; color: #666"
                      >(Configuration-driven)</span
                    >
                  </div>
                  <app-base-picker
                    [configId]="'manufacturer-model'"
                  ></app-base-picker>

                  <!-- ORIGINAL: TablePickerComponent (For comparison) -->
                  <div
                    style="
                      margin: 24px 0 8px 0;
                      padding: 8px;
                      background: #f0f0f0;
                      border: 1px solid #d9d9d9;
                      border-radius: 4px;
                    "
                  >
                    <strong style="color: #666"
                      >ðŸ”¹ ORIGINAL: TablePickerComponent</strong
                    >
                    <span style="margin-left: 8px; font-size: 12px; color: #999"
                      >(Legacy, for comparison)</span
                    >
                  </div>
                  <app-table-picker></app-table-picker>
                </div>
                <div *ngIf="item.panelType === 'results'">
                  <app-results-table></app-results-table>
                </div>
                <div *ngIf="item.panelType === 'plotly-charts'">
                  <app-plotly-histogram></app-plotly-histogram>
                </div>
                <div *ngIf="item.panelType === 'static-parabola'">
                  <app-static-parabola-chart></app-static-parabola-chart>
                </div>
              </div>
            </div>
          </gridster-item>
        </gridster>
      </div>
    </div>
  </div>

  <!-- Grid 4: Plotly Histograms -->
  <div *ngIf="grids[3]" class="grid-section">
    <div class="grid-section-header" (click)="toggleGridCollapse(grids[3].id)">
      <h3 class="grid-section-title">{{ getGridHeaderLabel(grids[3].id) }}</h3>
      <button
        type="button"
        class="grid-toggle-btn"
        [attr.aria-label]="isGridCollapsed(grids[3].id) ? 'Expand' : 'Collapse'"
      >
        <i
          nz-icon
          [nzType]="isGridCollapsed(grids[3].id) ? 'down' : 'up'"
          nzTheme="outline"
        ></i>
      </button>
    </div>
    <div
      class="grid-section-content"
      [class.collapsed]="isGridCollapsed(grids[3].id)"
    >
      <div class="grid-container-12" [attr.data-grid-id]="grids[3].id">
        <gridster [options]="grids[3].options">
          <gridster-item *ngFor="let item of grids[3]?.items" [item]="item">
            <div class="panel-container">
              <div class="panel-header drag-handle">
                <span class="panel-title">
                  <i nz-icon nzType="drag" nzTheme="outline"></i>
                  <ng-container [ngSwitch]="item.panelType">
                    <ng-container *ngSwitchCase="'picker'"
                      >Model Picker</ng-container
                    >
                    <ng-container *ngSwitchCase="'results'"
                      >Vehicle Results</ng-container
                    >
                    <ng-container *ngSwitchCase="'query-control'"
                      >Query Control</ng-container
                    >
                    <ng-container *ngSwitchCase="'plotly-charts'"
                      >Interactive Charts (Plotly)</ng-container
                    >
                    <ng-container *ngSwitchCase="'static-parabola'"
                      >Static Parabola Chart</ng-container
                    >
                    <ng-container *ngSwitchDefault>Panel</ng-container>
                  </ng-container>
                </span>
                <div class="panel-actions">
                  <i
                    nz-icon
                    nzType="export"
                    nzTheme="outline"
                    nz-tooltip="Pop out to new window"
                    (click)="
                      popOutPanel(grids[3].id, item); $event.stopPropagation()
                    "
                    class="action-icon popout-icon"
                  ></i>
                  <i
                    nz-icon
                    [nzType]="
                      item.panelType === 'picker'
                        ? getPanelCollapseState(grids[3].id)
                          ? 'down'
                          : 'up'
                        : 'close'
                    "
                    nzTheme="outline"
                    (click)="
                      item.panelType === 'picker'
                        ? togglePanelCollapse(grids[3].id)
                        : removePanel(item, grids[3].id)
                    "
                    class="action-icon"
                  ></i>
                </div>
              </div>
              <div
                class="panel-content no-drag"
                [hidden]="
                  item.panelType === 'picker' &&
                  getPanelCollapseState(grids[3].id)
                "
              >
                <!-- Dynamic panel content based on panelType -->
                <div *ngIf="item.panelType === 'query-control'">
                  <app-query-control
                    (filterAdd)="onFilterAdd($event)"
                    (filterRemove)="onFilterRemove($event)"
                  >
                  </app-query-control>
                </div>
                <div *ngIf="item.panelType === 'picker'">
                  <!-- NEW: BasePickerComponent (Configuration-Driven) -->
                  <div
                    style="
                      margin-bottom: 8px;
                      padding: 8px;
                      background: #e6f7ff;
                      border: 1px solid #91d5ff;
                      border-radius: 4px;
                    "
                  >
                    <strong style="color: #1890ff"
                      >âœ¨ NEW: BasePickerComponent</strong
                    >
                    <span style="margin-left: 8px; font-size: 12px; color: #666"
                      >(Configuration-driven)</span
                    >
                  </div>
                  <app-base-picker
                    [configId]="'manufacturer-model'"
                  ></app-base-picker>

                  <!-- ORIGINAL: TablePickerComponent (For comparison) -->
                  <div
                    style="
                      margin: 24px 0 8px 0;
                      padding: 8px;
                      background: #f0f0f0;
                      border: 1px solid #d9d9d9;
                      border-radius: 4px;
                    "
                  >
                    <strong style="color: #666"
                      >ðŸ”¹ ORIGINAL: TablePickerComponent</strong
                    >
                    <span style="margin-left: 8px; font-size: 12px; color: #999"
                      >(Legacy, for comparison)</span
                    >
                  </div>
                  <app-table-picker></app-table-picker>
                </div>
                <div *ngIf="item.panelType === 'results'">
                  <app-results-table></app-results-table>
                </div>
                <div *ngIf="item.panelType === 'plotly-charts'">
                  <app-plotly-histogram></app-plotly-histogram>
                </div>
                <div *ngIf="item.panelType === 'static-parabola'">
                  <app-static-parabola-chart></app-static-parabola-chart>
                </div>
              </div>
            </div>
          </gridster-item>
        </gridster>
      </div>
    </div>
  </div>
</div>
